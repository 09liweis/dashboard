import type { NextPage } from 'next'
import Head from 'next/head'
import { useEffect, useState } from 'react'
import styles from '../styles/Home.module.css'

const EXPANSE_API_DATA:string = 'https://samliweisen.herokuapp.com/api/transactions/statistics';

const Expense: NextPage = () => {
  const [expenses,setExpenses] = useState([]);
  const [expenseNm, setExpenseNm] = useState('')
  const [expenseVal, setExpenseVal] = useState('')
  const getExpenseStatistics = async () => {
    const opt = {
      method: 'POST',
      headers:{
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({date:'2022-08'})
    };
    const res = await fetch(EXPANSE_API_DATA,opt);
    const statistics = await res.json();
    console.log(statistics.categoryPrice);
  }
  useEffect(()=>{
    getExpenseStatistics();
    renderChart();
  },[]);

  const renderChart = () => {
    Highcharts.chart('container', {
      chart: {
        type: 'bar',
        animation:{
          duration:50
        }
      },
      title: {
        text: 'My Expenses'
      },
      xAxis: {
        type:'category'
      },
      yAxis: {
        min: 0,
        title: {
          text: 'Population (millions)',
          align: 'high'
        },
        labels: {
          overflow: 'justify'
        }
      },
      plotOptions: {
        bar: {
          dataLabels: {
            enabled: true
          }
        }
      },
      credits: {
        enabled: false
      },
      series: [{
        colorByPoint:true,
        data: [{
          name:'car',
          y:1234
        },{
          name:'bill',
          y:2234
        }]
      }]
    });

  }

  const editInput = (e:any,field:string) =>{
    const value = e.target.value;
    if (field == 'nm') {
      setExpenseNm(value);
    }
    if (field == 'val') {
      setExpenseVal(value);
    }
  }
  const addExpense = () =>{
    expenses.push({nm:expenseNm,val:expenseVal});
    setExpenses(expenses);
    setExpenseNm('');
    setExpenseVal('');
    console.log(expenses);
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Expense</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <h2>Expense Page</h2>
      <main>
        <input id='nm' placeholder='Category' value={expenseNm} onChange={(e)=>editInput(e,'nm')} />
        <input id='val' type='number' value={expenseVal} placeholder='Expense Amount' onChange={(e)=>editInput(e,'val')}/>
        <button onClick={addExpense}>Add</button>
        <div id="container" className='width-100 height-400'></div>
        <script async type="text/javascript" src="/js/highcharts.js"></script>
      </main>
    </div>
  )
}

export default Expense
